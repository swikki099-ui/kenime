{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/dashboard/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport {\n  Rocket,\n  Upload,\n  BarChart3,\n  Settings,\n  LogOut,\n  Plus,\n  Eye,\n  Trash2,\n  Globe,\n  HardDrive,\n  Calendar,\n  Loader2,\n  ExternalLink,\n} from 'lucide-react';\n\ninterface Site {\n  id: string;\n  name: string;\n  description: string | null;\n  is_published: boolean;\n  storage_bytes: number;\n  total_views: number;\n  last_deployed_at: string | null;\n  created_at: string;\n}\n\ninterface User {\n  username: string;\n  display_name: string | null;\n  email: string;\n  is_admin: boolean;\n  max_sites: number;\n}\n\nexport default function DashboardPage() {\n  const router = useRouter();\n  const [user, setUser] = useState<User | null>(null);\n  const [sites, setSites] = useState<Site[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [uploadFile, setUploadFile] = useState<File | null>(null);\n  const [uploading, setUploading] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState('');\n\n  useEffect(() => {\n    fetchUser();\n    fetchSites();\n  }, []);\n\n  const fetchUser = async () => {\n    try {\n      const response = await fetch('/api/auth/me');\n      if (!response.ok) {\n        router.push('/login');\n        return;\n      }\n      const data = await response.json();\n      setUser(data.user);\n    } catch (error) {\n      console.error('Failed to fetch user:', error);\n      router.push('/login');\n    }\n  };\n\n  const fetchSites = async () => {\n    try {\n      const response = await fetch('/api/sites');\n      if (!response.ok) {\n        throw new Error('Failed to fetch sites');\n      }\n      const data = await response.json();\n      setSites(data.sites);\n    } catch (error) {\n      console.error('Failed to fetch sites:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleLogout = async () => {\n    await fetch('/api/auth/logout', { method: 'POST' });\n    router.push('/');\n  };\n\n  const handleUpload = async (isPreview: boolean = false) => {\n    if (!uploadFile) return;\n\n    setUploading(true);\n    setUploadProgress(isPreview ? 'Creating preview...' : 'Uploading...');\n\n    try {\n      const formData = new FormData();\n      formData.append('file', uploadFile);\n      formData.append('siteName', 'default');\n      formData.append('isPreview', String(isPreview));\n\n      const response = await fetch('/api/upload', {\n        method: 'POST',\n        body: formData,\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        alert(data.error || 'Upload failed');\n        setUploading(false);\n        return;\n      }\n\n      if (isPreview) {\n        window.open(data.deployment.previewUrl, '_blank');\n      } else {\n        alert('Site uploaded successfully!');\n        fetchSites();\n      }\n\n      setUploadFile(null);\n      setUploadProgress('');\n    } catch (error) {\n      console.error('Upload error:', error);\n      alert('Upload failed');\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleDelete = async (siteId: string) => {\n    if (!confirm('Are you sure you want to delete this site?')) return;\n\n    try {\n      const response = await fetch('/api/sites', {\n        method: 'DELETE',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ siteId }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to delete site');\n      }\n\n      fetchSites();\n    } catch (error) {\n      console.error('Delete error:', error);\n      alert('Failed to delete site');\n    }\n  };\n\n  const formatBytes = (bytes: number) => {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\n  };\n\n  const formatDate = (dateString: string | null) => {\n    if (!dateString) return 'Never';\n    return new Date(dateString).toLocaleDateString();\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-blue-600\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <nav className=\"bg-white border-b sticky top-0 z-50\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center h-16\">\n            <Link href=\"/\" className=\"flex items-center space-x-2\">\n              <Rocket className=\"w-8 h-8 text-blue-600\" />\n              <span className=\"text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n                KENIME\n              </span>\n            </Link>\n            <div className=\"flex items-center space-x-4\">\n              <span className=\"text-gray-700\">\n                {user?.display_name || user?.username}\n              </span>\n              {user?.is_admin && (\n                <Link\n                  href=\"/admin\"\n                  className=\"text-purple-600 hover:text-purple-700 font-semibold\"\n                >\n                  Admin\n                </Link>\n              )}\n              <button\n                onClick={handleLogout}\n                className=\"flex items-center space-x-2 text-gray-600 hover:text-red-600 transition\"\n              >\n                <LogOut className=\"w-5 h-5\" />\n                <span>Logout</span>\n              </button>\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">Dashboard</h1>\n          <p className=\"text-gray-600\">\n            Manage your static sites and deployments\n          </p>\n        </div>\n\n        <div className=\"bg-white rounded-xl shadow-md p-6 mb-8 border border-gray-200\">\n          <h2 className=\"text-xl font-semibold mb-4 flex items-center space-x-2\">\n            <Upload className=\"w-6 h-6 text-blue-600\" />\n            <span>Upload New Site</span>\n          </h2>\n\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Upload ZIP File\n              </label>\n              <input\n                type=\"file\"\n                accept=\".zip\"\n                onChange={(e) => setUploadFile(e.target.files?.[0] || null)}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500\"\n              />\n              <p className=\"text-xs text-gray-500 mt-1\">\n                Upload a ZIP containing your HTML, CSS, and JavaScript files\n              </p>\n            </div>\n\n            {uploadFile && (\n              <div className=\"flex space-x-3\">\n                <button\n                  onClick={() => handleUpload(true)}\n                  disabled={uploading}\n                  className=\"flex items-center space-x-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50\"\n                >\n                  <Eye className=\"w-4 h-4\" />\n                  <span>Preview</span>\n                </button>\n                <button\n                  onClick={() => handleUpload(false)}\n                  disabled={uploading}\n                  className=\"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50\"\n                >\n                  <Upload className=\"w-4 h-4\" />\n                  <span>Publish</span>\n                </button>\n              </div>\n            )}\n\n            {uploading && (\n              <div className=\"flex items-center space-x-2 text-blue-600\">\n                <Loader2 className=\"w-4 h-4 animate-spin\" />\n                <span>{uploadProgress}</span>\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-xl shadow-md p-6 border border-gray-200\">\n          <h2 className=\"text-xl font-semibold mb-4 flex items-center space-x-2\">\n            <Globe className=\"w-6 h-6 text-blue-600\" />\n            <span>Your Sites</span>\n          </h2>\n\n          {sites.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <Globe className=\"w-16 h-16 text-gray-300 mx-auto mb-4\" />\n              <p className=\"text-gray-500 mb-2\">No sites yet</p>\n              <p className=\"text-sm text-gray-400\">\n                Upload a ZIP file to create your first site\n              </p>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {sites.map((site) => (\n                <div\n                  key={site.id}\n                  className=\"border border-gray-200 rounded-lg p-4 hover:shadow-md transition\"\n                >\n                  <div className=\"flex justify-between items-start\">\n                    <div className=\"flex-1\">\n                      <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n                        {site.name}\n                      </h3>\n                      {site.description && (\n                        <p className=\"text-gray-600 text-sm mb-3\">\n                          {site.description}\n                        </p>\n                      )}\n\n                      <div className=\"flex flex-wrap gap-4 text-sm text-gray-600\">\n                        <div className=\"flex items-center space-x-1\">\n                          <HardDrive className=\"w-4 h-4\" />\n                          <span>{formatBytes(site.storage_bytes)}</span>\n                        </div>\n                        <div className=\"flex items-center space-x-1\">\n                          <BarChart3 className=\"w-4 h-4\" />\n                          <span>{site.total_views} views</span>\n                        </div>\n                        <div className=\"flex items-center space-x-1\">\n                          <Calendar className=\"w-4 h-4\" />\n                          <span>Updated {formatDate(site.last_deployed_at)}</span>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"flex items-center space-x-2 ml-4\">\n                      {site.is_published && (\n                        <a\n                          href={`/${user?.username}`}\n                          target=\"_blank\"\n                          rel=\"noopener noreferrer\"\n                          className=\"flex items-center space-x-1 px-3 py-2 text-blue-600 hover:bg-blue-50 rounded-lg transition\"\n                        >\n                          <ExternalLink className=\"w-4 h-4\" />\n                          <span>View</span>\n                        </a>\n                      )}\n                      <button\n                        onClick={() => handleDelete(site.id)}\n                        className=\"flex items-center space-x-1 px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition\"\n                      >\n                        <Trash2 className=\"w-4 h-4\" />\n                        <span>Delete</span>\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </main>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}