{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/auth/session.ts"],"sourcesContent":["import { cookies } from 'next/headers';\nimport { createServerClient as createSupabaseServerClient } from '@supabase/ssr';\nimport { createClient } from '@supabase/supabase-js';\nimport { Database } from '../supabase/database.types';\n\nexport async function createServerClient() {\n  const cookieStore = await cookies();\n\n  return createSupabaseServerClient<Database>(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll();\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) => {\n              cookieStore.set(name, value, options);\n            });\n          } catch (error) {\n            console.error('Error setting cookies:', error);\n          }\n        },\n      },\n    }\n  );\n}\n\nexport function createServiceClient() {\n  return createClient<Database>(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!,\n    {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false,\n      },\n    }\n  );\n}\n\nexport async function getSession() {\n  const supabase = await createServerClient();\n  const { data: { session } } = await supabase.auth.getSession();\n  return session;\n}\n\nexport async function getCurrentUser() {\n  const session = await getSession();\n  if (!session) return null;\n\n  const supabase = await createServerClient();\n  const { data: user } = await supabase\n    .from('users')\n    .select('*')\n    .eq('id', session.user.id)\n    .single();\n\n  return user;\n}\n\nexport async function requireAuth() {\n  const user = await getCurrentUser();\n  if (!user) {\n    throw new Error('Unauthorized');\n  }\n  return user;\n}\n\nexport async function requireAdmin() {\n  const user = await requireAuth();\n  if (!user.is_admin) {\n    throw new Error('Forbidden: Admin access required');\n  }\n  return user;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;;;;;AAEA;;;;AAGO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,OAAO,2BACL,QAAQ,GAAG,CAAC,wBAAwB,EACpC,QAAQ,GAAG,CAAC,6BAA6B,EACzC;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE;wBAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;oBAC/B;gBACF,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,0BAA0B;gBAC1C;YACF;QACF;IACF;AAEJ;AAEO,SAAS;IACd,OAAO,IAAA,yMAAY,EACjB,QAAQ,GAAG,CAAC,wBAAwB,EACpC,QAAQ,GAAG,CAAC,yBAAyB,EACrC;QACE,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AAEJ;AAEO,eAAe;IACpB,MAAM,WAAW,MAAM;IACvB,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU;IAC5D,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,UAAU,MAAM;IACtB,IAAI,CAAC,SAAS,OAAO;IAErB,MAAM,WAAW,MAAM;IACvB,MAAM,EAAE,MAAM,IAAI,EAAE,GAAG,MAAM,SAC1B,IAAI,CAAC,SACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,QAAQ,IAAI,CAAC,EAAE,EACxB,MAAM;IAET,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,OAAO,MAAM;IACnB,IAAI,CAAC,MAAM;QACT,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,OAAO,MAAM;IACnB,IAAI,CAAC,KAAK,QAAQ,EAAE;QAClB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT"}},
    {"offset": {"line": 127, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/sites/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { requireAuth, createServiceClient } from '@/lib/auth/session';\n\nexport async function GET() {\n  try {\n    const user = await requireAuth();\n    const supabase = createServiceClient();\n\n    const { data: sites, error } = await supabase\n      .from('sites')\n      .select('*')\n      .eq('user_id', user.id)\n      .order('created_at', { ascending: false });\n\n    if (error) {\n      throw error;\n    }\n\n    return NextResponse.json({ sites: sites || [] });\n  } catch (error: any) {\n    console.error('Get sites error:', error);\n    if (error.message === 'Unauthorized') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n    return NextResponse.json(\n      { error: 'Failed to fetch sites' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function DELETE(request: Request) {\n  try {\n    const user = await requireAuth();\n    const { siteId } = await request.json();\n\n    if (!siteId) {\n      return NextResponse.json(\n        { error: 'Site ID is required' },\n        { status: 400 }\n      );\n    }\n\n    const supabase = createServiceClient();\n\n    const { error } = await supabase\n      .from('sites')\n      .delete()\n      .eq('id', siteId)\n      .eq('user_id', user.id);\n\n    if (error) {\n      throw error;\n    }\n\n    return NextResponse.json({ success: true });\n  } catch (error: any) {\n    console.error('Delete site error:', error);\n    if (error.message === 'Unauthorized') {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n    return NextResponse.json(\n      { error: 'Failed to delete site' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,uIAAW;QAC9B,MAAM,WAAW,IAAA,+IAAmB;QAEpC,MAAM,EAAE,MAAM,KAAK,EAAE,KAAK,EAAE,GAAG,MAAM,SAClC,IAAI,CAAC,SACL,MAAM,CAAC,KACP,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM;QAE1C,IAAI,OAAO;YACT,MAAM;QACR;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,SAAS,EAAE;QAAC;IAChD,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,oBAAoB;QAClC,IAAI,MAAM,OAAO,KAAK,gBAAgB;YACpC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QACA,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,OAAO,OAAgB;IAC3C,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,uIAAW;QAC9B,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,QAAQ,IAAI;QAErC,IAAI,CAAC,QAAQ;YACX,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAsB,GAC/B;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,WAAW,IAAA,+IAAmB;QAEpC,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SACrB,IAAI,CAAC,SACL,MAAM,GACN,EAAE,CAAC,MAAM,QACT,EAAE,CAAC,WAAW,KAAK,EAAE;QAExB,IAAI,OAAO;YACT,MAAM;QACR;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,sBAAsB;QACpC,IAAI,MAAM,OAAO,KAAK,gBAAgB;YACpC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QACA,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}